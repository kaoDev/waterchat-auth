variables:
  PROJECT_GROUP: waterchat
  PROJECT_NAME: micro-auth

stages:
  - test
  - build
  - deploy

build:
  stage: build
  script:
    - docker build --build-arg GITHUB_CALLBACK=$GITHUB_CALLBACK --build-arg GITHUB_ID=$GITHUB_ID --build-arg GITHUB_SECRET=$GITHUB_SECRET -t $PROJECT_GROUP/$PROJECT_NAME .
  tags:
    - shell

test:
  image: kkarczmarczyk/node-yarn
  stage: test
  script:
    - yarn install
    - yarn test
  tags:
    - docker

trigger_build:
  stage: deploy
  script:
    - "curl -X POST -F token=57ac25fd7c00d7282208c92486b851 -F ref=master https://office.cap3.de:52203/api/v4/projects/286/trigger/pipeline"
  tags:
    - shell